<!DOCTYPE html>
<html>
  <head>
    <title>Raster Reprojection</title>
    <link rel="stylesheet" href="ol.css" type="text/css">
    <script src="ol.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"></script>
    <style>
      html, body, #map {
        width: 100%;
        height: 100%;
        margin: 0;
      }
      #map {
        background-color: rgb(130, 181, 213)
      }
      #proj {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background-color: white;
        padding: 5px;
        font-size: 20pt;
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="map" class="map"></div>
    <div id="proj">EPSG:4326</div>
    <script>
      proj4.defs('Gall Peters', '+proj=cea +lon_0=0 +x_0=0 +y_0=0 +lat_ts=45 +ellps=WGS84 +datum=WGS84 +units=m +no_defs');
      var projGallPeters = ol.proj.get('Gall Peters');
      projGallPeters.setExtent([-14e6, -8.9e6, 14e6, 8.9e6]);

      proj4.defs('Mollweide', '+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 ' +
          '+units=m +no_defs');
      var proj54009 = ol.proj.get('Mollweide');
      proj54009.setExtent([-18e6, -18e6, 18e6, 18e6]);

      proj4.defs('EPSG:3577', '+proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs');
      var proj3577 = ol.proj.get('EPSG:3577');
      //proj3577.setExtent([-1594494.51, -4894565.95, 2436270.29,-1240480.01]);

      var layer = new ol.layer.Tile({
        source: new ol.source.TileWMS({
          url: 'http://demo.boundlessgeo.com/geoserver/wms',
          crossOrigin: '',
          params: {
            'LAYERS': 'ne:NE1_HR_LC_SR_W_DR'
          },
          projection: 'EPSG:4326',
          reprojectionErrorThreshold: 2
        })
      });
      layer.getSource().setRenderReprojectionEdges(true);

      var map = new ol.Map({
        layers: [layer],
        controls: [],
        interactions: [],
        target: 'map',
        view: new ol.View({
          projection: 'EPSG:4326',
          center: [131, -26],
          zoom: 4,
          minZoom: 4
        })
      });


      var baseLayerSelect = document.getElementById('base-layer');
      var viewProjSelect = document.getElementById('view-projection');
      var renderEdgesCheckbox = document.getElementById('render-edges');
      var renderEdges = false;

      function updateViewProjection(proj) {
        var newProj = ol.proj.get(proj);
        var newProjExtent = newProj.getExtent();
        var newView = new ol.View({
          projection: newProj,
          center: ol.proj.transform([131, -26], 'EPSG:4326', proj),
          zoom: 4,
          minZoom: 4,
          extent: newProjExtent || undefined
        });
        map.setView(newView);

      }

      var projections = [
        'EPSG:3857',
        'EPSG:3577',
        'Gall Peters',
        'Mollweide',
        'EPSG:4326'
      ];
      var projIndex = 0;
      window.setInterval(function() {
        var proj = projections[projIndex]
        updateViewProjection(proj);
        document.getElementById('proj').innerHTML = proj;
        projIndex++;
        if (projIndex >= projections.length) {
          projIndex = 0;
          renderEdges = !renderEdges;
        }
      }, 2500);
    </script>
  </body>
</html>
